!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XHRMock=e()}(this,function(){"use strict";var d=(t.prototype.status=function(t){return void 0!==t?(this._status=t,this):this._status},t.prototype.reason=function(t){return void 0!==t?(this._reason=t,this):this._reason},t.prototype.statusText=function(t){return console.warn("xhr-mock: MockResponse.statusText() has been deprecated. Use MockResponse.reason() instead."),void 0!==t?this.reason(t):this.reason()},t.prototype.header=function(t,e){return void 0!==e?(this._headers[t.toLowerCase()]=e,this):this._headers[t.toLowerCase()]||null},t.prototype.headers=function(t){if("object"!=typeof t)return this._headers;for(var e in t)t.hasOwnProperty(e)&&this.header(e,t[e]);return this},t.prototype.body=function(t){return void 0!==t?(this._body=t,this):this._body},t);function t(){this._status=200,this._reason="OK",this._headers={},this._body=null}function o(l,c,f){return function(t,e){if(u=(a=t).method(),p=a.url().toString(),u.toUpperCase()===l.toUpperCase()&&(c instanceof RegExp?(c.lastIndex=0,c.test(p)):p===c))return"object"==typeof f?(n=(r=f).status,o=r.reason,s=r.headers,i=r.body,h=new d,n&&h.status(n),o&&h.reason(o),s&&h.headers(s),i&&h.body(i),h):f(t,e);var r,n,o,s,i,h,a,u,p}}var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function e(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function r(r,n){var o,s,i,h={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,s&&(i=s[2&e[0]?"return":e[0]?"throw":"next"])&&!(i=i.call(s,e[1])).done)return i;switch(s=0,i&&(e=[0,i.value]),e[0]){case 0:case 1:i=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,s=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(i=0<(i=h.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){h.label=e[1];break}if(6===e[0]&&h.label<i[1]){h.label=i[1],i=e;break}if(i&&h.label<i[2]){h.label=i[2],h.ops.push(e);break}i[2]&&h.ops.pop(),h.trys.pop();continue}e=n.call(r,h)}catch(t){e=[6,t],s=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var j="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t,e){return t(e={exports:{}},e.exports),e.exports}var P=s(function(q,_){!function(t){var e=_&&!_.nodeType&&_,r=q&&!q.nodeType&&q,n="object"==typeof j&&j;n.global!==n&&n.window!==n&&n.self!==n||(t=n);var o,s,v=2147483647,E=36,b=1,w=26,i=38,h=700,g=72,O=128,S="-",a=/^xn--/,u=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,l={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=E-b,C=Math.floor,N=String.fromCharCode;function T(t){throw RangeError(l[t])}function f(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function d(t,e){var r=t.split("@"),n="";return 1<r.length&&(n=r[0]+"@",t=r[1]),n+f((t=t.replace(p,".")).split("."),e).join(".")}function R(t){for(var e,r,n=[],o=0,s=t.length;o<s;)55296<=(e=t.charCodeAt(o++))&&e<=56319&&o<s?56320==(64512&(r=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--):n.push(e);return n}function x(t){return f(t,function(t){var e="";return 65535<t&&(e+=N((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=N(t)}).join("")}function A(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function D(t,e,r){var n=0;for(t=r?C(t/h):t>>1,t+=C(t/e);c*w>>1<t;n+=E)t=C(t/c);return C(n+(c+1)*t/(t+i))}function y(t){var e,r,n,o,s,i,h,a,u,p,l=[],c=t.length,f=0,d=O,y=g,m=t.lastIndexOf(S);for(m<0&&(m=0),r=0;r<m;++r)128<=t.charCodeAt(r)&&T("not-basic"),l.push(t.charCodeAt(r));for(n=0<m?m+1:0;n<c;){for(o=f,s=1,i=E;c<=n&&T("invalid-input"),p=t.charCodeAt(n++),(E<=(h=p-48<10?p-22:p-65<26?p-65:p-97<26?p-97:E)||h>C((v-f)/s))&&T("overflow"),f+=h*s,!(h<(a=i<=y?b:y+w<=i?w:i-y));i+=E)s>C(v/(u=E-a))&&T("overflow"),s*=u;y=D(f-o,e=l.length+1,0==o),C(f/e)>v-d&&T("overflow"),d+=C(f/e),f%=e,l.splice(f++,0,d)}return x(l)}function m(t){for(var e,r,n,o,s,i,h,a,u,p,l,c=[],f=(t=R(t)).length,d=O,y=g,m=e=0;m<f;++m)(a=t[m])<128&&c.push(N(a));for(r=n=c.length,n&&c.push(S);r<f;){for(o=v,m=0;m<f;++m)d<=(a=t[m])&&a<o&&(o=a);for(o-d>C((v-e)/(u=r+1))&&T("overflow"),e+=(o-d)*u,d=o,m=0;m<f;++m)if((a=t[m])<d&&++e>v&&T("overflow"),a==d){for(s=e,i=E;!(s<(h=i<=y?b:y+w<=i?w:i-y));i+=E)l=s-h,p=E-h,c.push(N(A(h+l%p,0))),s=C(l/p);c.push(N(A(s,0))),y=D(e,u,r==n),e=0,++r}++e,++d}return c.join("")}if(o={version:"1.3.2",ucs2:{decode:R,encode:x},decode:y,encode:m,toASCII:function(t){return d(t,function(t){return u.test(t)?"xn--"+m(t):t})},toUnicode:function(t){return d(t,function(t){return a.test(t)?y(t.slice(4).toLowerCase()):t})}},0,e&&r)if(q.exports==e)r.exports=o;else for(s in o)o.hasOwnProperty(s)&&(e[s]=o[s]);else t.punycode=o}(j)}),I={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function i(t,e,r,n){e=e||"&",r=r||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var h=t.length;0<i&&i<h&&(h=i);for(var a,u,p=0;p<h;++p){var l,c=t[p].replace(s,"%20"),f=c.indexOf(r),d=0<=f?(l=c.substr(0,f),c.substr(f+1)):(l=c,""),y=decodeURIComponent(l),m=decodeURIComponent(d);a=o,u=y,Object.prototype.hasOwnProperty.call(a,u)?Array.isArray(o[y])?o[y].push(m):o[y]=[o[y],m]:o[y]=m}return o}function h(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function a(r,n,o,t){return n=n||"&",o=o||"=",null===r&&(r=void 0),"object"==typeof r?Object.keys(r).map(function(t){var e=encodeURIComponent(h(t))+o;return Array.isArray(r[t])?r[t].map(function(t){return e+encodeURIComponent(h(t))}).join(n):e+encodeURIComponent(h(r[t]))}).join(n):t?encodeURIComponent(h(t))+o+encodeURIComponent(h(r)):""}var U=s(function(t,e){e.decode=e.parse=i,e.encode=e.stringify=a}),u=(U.decode,U.parse,U.encode,U.stringify,y),l=function(t){I.isString(t)&&(t=y(t));return t instanceof R?t.format():R.prototype.format.call(t)};function R(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var k=/^([a-z0-9.+-]+:)/i,c=/:[0-9]*$/,H=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,f=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),L=["'"].concat(f),M=["%","/","?",";","#"].concat(L),G=["/","?","#"],X=/^[+a-z0-9A-Z_-]{0,63}$/,F=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,V={javascript:!0,"javascript:":!0},B={javascript:!0,"javascript:":!0},K={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function y(t,e,r){if(t&&I.isObject(t)&&t instanceof R)return t;var n=new R;return n.parse(t,e,r),n}R.prototype.parse=function(t,e,r){if(!I.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),o=-1!==n&&n<t.indexOf("#")?"?":"#",s=t.split(o);s[0]=s[0].replace(/\\/g,"/");var i=(i=t=s.join(o)).trim();if(!r&&1===t.split("#").length){var h=H.exec(i);if(h)return this.path=i,this.href=i,this.pathname=h[1],h[2]?(this.search=h[2],this.query=e?U.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var a,u,p=k.exec(i);if(p&&(a=(p=p[0]).toLowerCase(),this.protocol=a,i=i.substr(p.length)),(r||p||i.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(u="//"===i.substr(0,2))||p&&B[p]||(i=i.substr(2),this.slashes=!0)),!B[p]&&(u||p&&!K[p])){for(var l,c,f=-1,d=0;d<G.length;d++){-1!==(y=i.indexOf(G[d]))&&(-1===f||y<f)&&(f=y)}-1!==(c=-1===f?i.lastIndexOf("@"):i.lastIndexOf("@",f))&&(l=i.slice(0,c),i=i.slice(c+1),this.auth=decodeURIComponent(l)),f=-1;for(var y,d=0;d<M.length;d++){-1!==(y=i.indexOf(M[d]))&&(-1===f||y<f)&&(f=y)}-1===f&&(f=i.length),this.host=i.slice(0,f),i=i.slice(f),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var v=this.hostname.split(/\./),d=0,E=v.length;d<E;d++){var b=v[d];if(b&&!b.match(X)){for(var w="",g=0,O=b.length;g<O;g++)127<b.charCodeAt(g)?w+="x":w+=b[g];if(!w.match(X)){var S=v.slice(0,d),C=v.slice(d+1),N=b.match(F);N&&(S.push(N[1]),C.unshift(N[2])),C.length&&(i="/"+C.join(".")+i),this.hostname=S.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=P.toASCII(this.hostname));var T=this.port?":"+this.port:"",R=this.hostname||"";this.host=R+T,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0]&&(i="/"+i))}if(!V[a])for(d=0,E=L.length;d<E;d++){var x,A=L[d];-1!==i.indexOf(A)&&((x=encodeURIComponent(A))===A&&(x=escape(A)),i=i.split(A).join(x))}var D=i.indexOf("#");-1!==D&&(this.hash=i.substr(D),i=i.slice(0,D));var q,_=i.indexOf("?");return-1!==_?(this.search=i.substr(_),this.query=i.substr(_+1),e&&(this.query=U.parse(this.query)),i=i.slice(0,_)):e&&(this.search="",this.query={}),i&&(this.pathname=i),K[a]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(T=this.pathname||"",q=this.search||"",this.path=T+q),this.href=this.format(),this},R.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&I.isObject(this.query)&&Object.keys(this.query).length&&(s=U.stringify(this.query));var i=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||K[e])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o=o||"",n&&"#"!==n.charAt(0)&&(n="#"+n),i&&"?"!==i.charAt(0)&&(i="?"+i),e+o+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(i=i.replace("#","%23"))+n},R.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},R.prototype.resolveObject=function(t){var e;I.isString(t)&&((e=new R).parse(t,!1,!0),t=e);for(var r,n,o=new R,s=Object.keys(this),i=0;i<s.length;i++){var h=s[i];o[h]=this[h]}if(o.hash=t.hash,""===t.href)return o.href=o.format(),o;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),u=0;u<a.length;u++){var p=a[u];"protocol"!==p&&(o[p]=t[p])}return K[o.protocol]&&o.hostname&&!o.pathname&&(o.path=o.pathname="/"),o.href=o.format(),o}if(t.protocol&&t.protocol!==o.protocol){if(!K[t.protocol]){for(var l=Object.keys(t),c=0;c<l.length;c++){var f=l[c];o[f]=t[f]}return o.href=o.format(),o}if(o.protocol=t.protocol,t.host||B[t.protocol])o.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),o.pathname=d.join("/")}return o.search=t.search,o.query=t.query,o.host=t.host||"",o.auth=t.auth,o.hostname=t.hostname||t.host,o.port=t.port,(o.pathname||o.search)&&(r=o.pathname||"",n=o.search||"",o.path=r+n),o.slashes=o.slashes||t.slashes,o.href=o.format(),o}var y=o.pathname&&"/"===o.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=m||y||o.host&&t.pathname,E=v,b=o.pathname&&o.pathname.split("/")||[],d=t.pathname&&t.pathname.split("/")||[],w=o.protocol&&!K[o.protocol];if(w&&(o.hostname="",o.port=null,o.host&&(""===b[0]?b[0]=o.host:b.unshift(o.host)),o.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),v=v&&(""===d[0]||""===b[0])),m)o.host=t.host||""===t.host?t.host:o.host,o.hostname=t.hostname||""===t.hostname?t.hostname:o.hostname,o.search=t.search,o.query=t.query,b=d;else if(d.length)(b=b||[]).pop(),b=b.concat(d),o.search=t.search,o.query=t.query;else if(!I.isNullOrUndefined(t.search)){return w&&(o.hostname=o.host=b.shift(),(N=!!(o.host&&0<o.host.indexOf("@"))&&o.host.split("@"))&&(o.auth=N.shift(),o.host=o.hostname=N.shift())),o.search=t.search,o.query=t.query,I.isNull(o.pathname)&&I.isNull(o.search)||(o.path=(o.pathname?o.pathname:"")+(o.search?o.search:"")),o.href=o.format(),o}if(!b.length)return o.pathname=null,o.search?o.path="/"+o.search:o.path=null,o.href=o.format(),o;for(var g=b.slice(-1)[0],O=(o.host||t.host||1<b.length)&&("."===g||".."===g)||""===g,S=0,C=b.length;0<=C;C--)"."===(g=b[C])?b.splice(C,1):".."===g?(b.splice(C,1),S++):S&&(b.splice(C,1),S--);if(!v&&!E)for(;S--;)b.unshift("..");!v||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),O&&"/"!==b.join("/").substr(-1)&&b.push("");var N,T=""===b[0]||b[0]&&"/"===b[0].charAt(0);return w&&(o.hostname=o.host=!T&&b.length?b.shift():"",(N=!!(o.host&&0<o.host.indexOf("@"))&&o.host.split("@"))&&(o.auth=N.shift(),o.host=o.hostname=N.shift())),(v=v||o.host&&b.length)&&!T&&b.unshift(""),b.length?o.pathname=b.join("/"):(o.pathname=null,o.path=null),I.isNull(o.pathname)&&I.isNull(o.search)||(o.path=(o.pathname?o.pathname:"")+(o.search?o.search:"")),o.auth=t.auth||o.auth,o.slashes=o.slashes||t.slashes,o.href=o.format(),o},R.prototype.parseHost=function(){var t=this.host,e=c.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var m=(v.prototype.toString=function(){return b(this)},v);function v(){}function E(t){var e=new m;if(!t)return e;var r,n,o,s=u(t,!0);return s.protocol&&(e.protocol=s.protocol.substr(0,s.protocol.length-1)),s.auth&&(n=(r=s.auth.split(":"))[0],o=r[1],n&&o?(e.username=n,e.password=o):e.username=n),s.hostname&&(e.host=s.hostname),s.port&&(e.port=parseInt(s.port,10)),s.pathname&&(e.path=s.pathname),s.query&&(e.query=s.query),s.hash&&(e.hash=s.hash),e}function b(t){var e={protocol:t.protocol,auth:t.username&&t.password?t.username+":"+t.password:t.username,hostname:t.host,port:"number"==typeof t.port?String(t.port):t.port,pathname:t.path,query:t.query,hash:t.hash};return l(e)}var w=["CONNECT","TRACE","TRACK"],g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],O=(S.prototype.method=function(t){if(void 0===t)return this._method;if(-1!==w.indexOf(t.toUpperCase()))throw new Error('xhr-mock: Method "'+t+'" is forbidden.');return-1!==g.indexOf(t.toUpperCase())?this._method=t.toUpperCase():this._method=t,this},S.prototype.url=function(t){return"string"==typeof t?(this._url=E(t),this):this._url},S.prototype.header=function(t,e){return void 0!==e?(this._headers[t.toLowerCase()]=e,this):this._headers[t.toLowerCase()]||null},S.prototype.headers=function(t){if("object"!=typeof t)return this._headers;for(var e in t)t.hasOwnProperty(e)&&this.header(e,t[e]);return this},S.prototype.body=function(t){return void 0!==t?(this._body=t,this):this._body},S);function S(){this._method="GET",this._url=E(""),this._headers={},this._body=null}var C=(N.prototype.initEvent=function(t,e,r){throw new Error},N.prototype.preventDefault=function(){throw new Error},N.prototype.stopImmediatePropagation=function(){throw new Error},N.prototype.stopPropagation=function(){throw new Error},N.prototype.deepPath=function(){throw new Error},N);function N(t,e){var r,n,o,s,i,h;this.eventPhase=0,this.type=t||"",e&&(n=void 0!==(r=e.scoped)&&r,s=void 0!==(o=e.bubbles)&&o,h=void 0!==(i=e.cancelable)&&i,this.scoped=n,this.bubbles=s,this.cancelable=h)}var T,x=(e(A,T=C),A.prototype.initProgressEvent=function(t,e,r,n,o,s){throw new Error},A);function A(t,e){var r,n,o,s,i,h,a=T.call(this,t,e)||this;return e&&(n=void 0!==(r=e.lengthComputable)&&r,s=void 0===(o=e.loaded)?0:o,h=void 0===(i=e.total)?0:i,a.lengthComputable=n,a.loaded=s,a.total=h),a}var D=(q.prototype.addEventListener=function(t,e,r){this.listeners=this.listeners||{},e&&(this.listeners[t]||(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e))},q.prototype.removeEventListener=function(t,e,r){var n;this.listeners=this.listeners||{},e&&(!this.listeners[t]||-1!==(n=this.listeners[t].indexOf(e))&&this.listeners[t].splice(n,1))},q.prototype.dispatchEvent=function(e){var r=this;this.listeners=this.listeners||{},e.target=this;var t=(e.currentTarget=this)["on"+e.type];return t&&t.call(this,e),this.listeners[e.type]&&this.listeners[e.type].forEach(function(t){"function"==typeof t?t.call(r,e):t.handleEvent.call(r,e)}),!0},q);function q(){this.listeners={}}var _,$=(e(z,_=D),z);function z(){return null!==_&&_.apply(this,arguments)||this}var Z,J=(e(Q,Z=$),Q);function Q(){return null!==Z&&Z.apply(this,arguments)||this}var W,Y=(e(tt,W=Error),tt);function tt(t){var e=W.call(this,t)||this;return Object.setPrototypeOf(e,tt.prototype),e}var et=new Y("No handler returned a response for the request.");function rt(t,r){return t.split("\n").map(function(t,e){return Array(r+1).join(" ")+t}).join("\n")}function nt(t,e,r){return"xhr-mock: "+t+"\n\n  "+rt((n=e,o=Object.keys(n.headers()).map(function(t){return t+": "+n.header(t)}),s=n.body()?n.body():"",n.method()+" "+n.url()+" HTTP/1.1\n"+(o?o.join("\n")+"\n":"")+"\n"+(s||"")+"\n"),2).trim()+"\n  "+(void 0!==r?"\n"+rt(r&&r.stack||r&&r.message||"Error: "+r,2):"")+"\n";var n,o,s}var ot,st,it=new Y("This feature hasn't been implmented yet. Please submit an Issue or Pull Request on Github."),ht=["CONNECT","TRACE","TRACK"];function at(t){var e,r=t.header("content-length"),n=t.body(),o=!1,s=0;return!r||NaN!==(e=parseInt(r,10))&&(o=!0,s=e),{lengthComputable:o,loaded:n&&n.length||0,total:s}}(st=ot=ot||{})[st.UNSENT=0]="UNSENT",st[st.OPENED=1]="OPENED",st[st.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",st[st.LOADING=3]="LOADING",st[st.DONE=4]="DONE";var ut,pt=(e(lt,ut=$),lt.addHandler=function(t){this.handlers.push(t)},lt.removeHandler=function(t){throw it},lt.removeAllHandlers=function(){this.handlers=[]},Object.defineProperty(lt.prototype,"timeout",{get:function(){return this._timeout},set:function(t){if(0!==t&&this.isSynchronous)throw new Y("Timeouts cannot be set for synchronous requests made from a document.");this._timeout=t},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"response",{get:function(){if(""===this.responseType||"text"===this.responseType)return this.readyState!==this.LOADING&&this.readyState!==this.DONE?"":this.responseText;if(this.readyState!==this.DONE)return null;var t=this.res.body();if(!t)return null;if("json"===this.responseType&&"string"==typeof t)try{return JSON.parse(this.responseText)}catch(t){return null}if("blob"===this.responseType&&"string"==typeof t)try{throw it}catch(t){return null}if("arraybuffer"===this.responseType&&"string"==typeof t)try{throw it}catch(t){return null}if("document"===this.responseType&&"string"==typeof t)try{throw it}catch(t){return null}return t},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"responseText",{get:function(){return this.res.body()||""},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"responseXML",{get:function(){throw it},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"status",{get:function(){return this.res.status()},enumerable:!0,configurable:!0}),Object.defineProperty(lt.prototype,"statusText",{get:function(){return this.res.reason()},enumerable:!0,configurable:!0}),lt.prototype.getAllResponseHeaders=function(){var e=this.res.headers();return Object.keys(e).map(function(t){return t+": "+e[t]+"\r\n"}).join("")},lt.prototype.getResponseHeader=function(t){return this.readyState<lt.HEADERS_RECEIVED?null:this.res.header(t)},lt.prototype.setRequestHeader=function(t,e){if(this.readyState<lt.OPENED)throw new Y("xhr must be OPENED.");this.req.header(t,e)},lt.prototype.overrideMimeType=function(t){throw it},lt.prototype.open=function(t,e,r,n,o){if(void 0===r&&(r=!0),void 0===n&&(n=null),void 0===o&&(o=null),-1!==ht.indexOf(t))throw new Y("Method "+t+" is forbidden.");t=t.toUpperCase();var s=E(e);if(s.username=n||"",s.password=n&&o||"",!r&&(0!==this._timeout||""!==this.responseType))throw new Y("InvalidAccessError");if(this.isSending)throw new Y("Unable to terminate the previous request");this.isSending=!1,this.isSynchronous=!r,this.req.method(t).headers({}).url(b(s)),this.applyNetworkError(),this.readyState!==this.OPENED&&(this.readyState=lt.OPENED,this.dispatchEvent(new C("readystatechange")))},lt.prototype.sendSync=function(){var t;try{t=function(t,e,r){for(var n,o=0;o<t.length;++o){var s=t[o](e,r);if(s){if((n=s)&&void 0!==n.then)throw new Y("A handler returned a Promise<MockResponse> for a synchronous request.");return s}}throw et}(lt.handlers,this.req,this.res),this.handleResponseBody(t)}catch(t){lt.errorCallback({req:this.req,err:t}),this.handleError(t)}},lt.prototype.sendAsync=function(){return s=this,a=function(){var o,s,i,h,a,u=this;return r(this,function(t){switch(t.label){case 0:if(o=this.req,s=at(this.res),this.dispatchEvent(new x("loadstart",p({},s,{loaded:0}))),this.isUploadComplete||(i=at(this.req),this.upload.dispatchEvent(new x("loadstart",p({},i,{loaded:0})))),this.readyState!==this.OPENED||!this.isSending)return[2];0!==this._timeout&&(this._timeoutTimer=setTimeout(function(){u.isTimedOut=!0,u.handleError()},this._timeout)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=lt.handlers,r=this.req,n=this.res,e.reduce(function(t,e){return t.then(function(t){return t||e(r,n)})},Promise.resolve(void 0)).then(function(t){if(!t)throw et;return t}))];case 2:return h=t.sent(),clearTimeout(this._timeoutTimer),this.isAborted||this.isTimedOut?[2]:(this.sendRequest(o),this.receiveResponse(h),[3,4]);case 3:return a=t.sent(),clearTimeout(this._timeoutTimer),this.isAborted||this.isTimedOut?[2]:(lt.errorCallback({req:this.req,err:a}),this.handleError(a),[3,4]);case 4:return[2]}var e,r,n})},h=i=void 0,new(h=Promise)(function(t,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function n(t){try{o(a.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new h(function(t){t(e.value)}).then(r,n)}o((a=a.apply(s,i||[])).next())});var s,i,h,a},lt.prototype.applyNetworkError=function(){this.res.status(0).reason("").headers({}).body(null)},lt.prototype.reportError=function(t){if(this.readyState=this.DONE,this.isSending=!1,this.applyNetworkError(),this.isSynchronous)throw new Y("An error occurred whilst sending a synchronous request.");var e;this.dispatchEvent(new C("readystatechange")),this.isUploadComplete||(this.isUploadComplete=!0,e=at(this.req),this.upload.dispatchEvent(new x(t,e)),this.upload.dispatchEvent(new x("loadend",e)));var r=at(this.res);this.dispatchEvent(new x(t,r)),this.dispatchEvent(new x("loadend",r))},lt.prototype.sendRequest=function(t){var e;this.isUploadComplete||(this.isUploadComplete=!0,e=at(this.req),this.upload.dispatchEvent(new x("progress",e)),this.upload.dispatchEvent(new x("load",e)),this.upload.dispatchEvent(new x("loadend",e)))},lt.prototype.receiveResponse=function(t){this.readyState=this.HEADERS_RECEIVED,this.dispatchEvent(new C("readystatechange")),null!==t.body()&&(this.readyState=this.LOADING,this.dispatchEvent(new C("readystatechange"))),this.handleResponseBody(t)},lt.prototype.handleError=function(t){this.isSending&&(this.isTimedOut?this.reportError("timeout"):this.isAborted?this.reportError("abort"):this.reportError("error"))},lt.prototype.handleResponseBody=function(t){var e=at(this.res=t);this.isSynchronous||this.dispatchEvent(new x("progress",e)),this.readyState=this.DONE,this.isSending=!1,this.dispatchEvent(new C("readystatechange")),this.dispatchEvent(new x("load",e)),this.dispatchEvent(new x("loadend",e))},lt.prototype.send=function(t){if(this.readyState!==lt.OPENED)throw new Y("Please call MockXMLHttpRequest.open() before MockXMLHttpRequest.send().");if(this.isSending)throw new Y("MockXMLHttpRequest.send() has already been called.");var e,r;if("GET"!==this.req.method()&&"HEAD"!==this.req.method()||(t=null),null!=t){if("undefined"!=typeof Document&&"undefined"!=typeof XMLDocument&&t instanceof Document)e="UTF-8",r=t instanceof XMLDocument?"application/xml":"text/html";else if("undefined"!=typeof Blob&&t instanceof Blob)r=t.type;else if("undefined"!=typeof FormData&&t instanceof FormData)r="multipart/form-data; boundary=----XHRMockFormBoundary";else if("undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams)e="UTF-8",r="application/x-www-form-urlencoded";else{if("string"!=typeof t)throw it;e="UTF-8",r="text/plain"}this.req.header("content-type")||this.req.header("content-type",e?r+"; charset="+e:r),this.req.body(t)}this.isUploadComplete=!1,this.isTimedOut=!1,null==t&&(this.isUploadComplete=!0),this.isSending=!0,this.isSynchronous?this.sendSync():this.sendAsync()},lt.prototype.abort=function(){if(clearTimeout(this._timeoutTimer),this.isAborted=!0,this.readyState!==this.OPENED&&this.readyState!==this.HEADERS_RECEIVED&&this.readyState!==this.LOADING||this.reportError("abort"),this.readyState===this.DONE)return this.readyState=this.UNSENT,void this.applyNetworkError()},lt.prototype.msCachingEnabled=function(){return!1},lt.UNSENT=ot.UNSENT,lt.OPENED=ot.OPENED,lt.HEADERS_RECEIVED=ot.HEADERS_RECEIVED,lt.LOADING=ot.LOADING,lt.DONE=ot.DONE,lt.handlers=[],lt.errorCallback=function(t){var e=t.req,r=t.err;r instanceof Y?console.error(nt(r.message,e)):console.error(nt("A handler returned an error for the request.",e,r))},lt);function lt(){var t=null!==ut&&ut.apply(this,arguments)||this;return t.UNSENT=ot.UNSENT,t.OPENED=ot.OPENED,t.HEADERS_RECEIVED=ot.HEADERS_RECEIVED,t.LOADING=ot.LOADING,t.DONE=ot.DONE,t.withCredentials=!1,t.req=new O,t.res=new d,t.responseType="",t.responseURL="",t._timeout=0,t.upload=new J,t.readyState=lt.UNSENT,t.isSynchronous=!1,t.isSending=!1,t.isUploadComplete=!1,t.isAborted=!1,t.isTimedOut=!1,t}var ct=window.XMLHttpRequest;function ft(){this.RealXMLHttpRequest=ct}return new(ft.prototype.setup=function(){return window.XMLHttpRequest=pt,this.reset(),this},ft.prototype.teardown=function(){return this.reset(),window.XMLHttpRequest=ct,this},ft.prototype.reset=function(){return pt.removeAllHandlers(),this},ft.prototype.error=function(t){return pt.errorCallback=t,this},ft.prototype.mock=function(t,e,r){if(console.warn("xhr-mock: XHRMock.mock() has been deprecated. Use XHRMock.use() instead."),"string"==typeof t&&("string"==typeof e||e instanceof RegExp)&&void 0!==r)return this.use(t,e,r);if("function"==typeof t)return this.use(t);throw new Error("xhr-mock: Invalid handler.")},ft.prototype.use=function(t,e,r){var n;if("string"==typeof t&&("string"==typeof e||e instanceof RegExp)&&void 0!==r)n=o(t,e,r);else{if("function"!=typeof t)throw new Error("xhr-mock: Invalid handler.");n=t}return pt.addHandler(n),this},ft.prototype.get=function(t,e){return this.use("GET",t,e)},ft.prototype.post=function(t,e){return this.use("POST",t,e)},ft.prototype.put=function(t,e){return this.use("PUT",t,e)},ft.prototype.patch=function(t,e){return this.use("PATCH",t,e)},ft.prototype.delete=function(t,e){return this.use("DELETE",t,e)},ft)});