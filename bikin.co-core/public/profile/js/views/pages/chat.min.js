var $chat=$("#sc-chat"),$submit=$("#sc-chat-message-submit"),$input=$("#sc-chat-message-input"),messages=[];scutum.pages.chat={},scutum.pages.chat.init=function(){$chat.addClass("sc-light"),scutum.pages.chat.message.fillChat(),scutum.pages.chat.message.send(),scutum.pages.chat.users(),scutum.pages.chat.generateUserList(),scutum.pages.chat.events()},scutum.pages.chat.message={fillChat:function(){scutum.require(["handlebars"],function(){$.when(scutum.handlebars.getPartial("chat-message"),scutum.helpers.ajax("data/pages/chat_messages.json","GET","json")).done(function(e,s){Handlebars.registerPartial("chat-message",e);var t=[];$.each(s,function(e,s){e<4?messages.push(s):t.push(s)}),$chat.one("render.handlebars",function(e,s){scutum.helpers.hiResImagesProcess()}).hbRender("chat-messages",{messages:messages}),setTimeout(function(){$chat.one("render.handlebars",function(e,s){$chat.find(".sc-sequence-show.sc-chat-messages-wrapper").each(function(e){var s=$(this);setTimeout(function(){scutum.helpers.sequenceShow.activate(s,"uk-animation-slide-left"),scutum.helpers.hiResImagesProcess()},200*(e+1))})}).hbRender("chat-messages",{messages:t,delayed:!0},!0)},1e3)})},!1)},send:function(){function s(){function t(){$input.val(""),$chat.closest(".uk-card-body").scrollTop($chat[0].scrollHeight)}var e,s,a=scutum.helpers.escapeHTML($input.val()),n=$chat.find(".sc-chat-messages-wrapper").last();""!==a&&(n.hasClass("my")?(e=n.find("[data-message-time]:last").find("time").text(),s=moment().format("HH:mm"),n.find(".sc-chat-messages").one("render.handlebars",function(e,s){scutum.helpers.sequenceShow.activate(n.find(".sc-sequence-show").last(),"uk-animation-slide-right"),t()}).hbRender("chat-message",{content:a,time:e!==s?moment().format("HH:mm"):"",animated:!0},!0)):$chat.one("render.handlebars",function(e,s){scutum.helpers.sequenceShow.activate($chat.find(".sc-sequence-show").last(),"uk-animation-slide-right"),t()}).hbRender("chat-messages",{messages:[{id:scutum.helpers.uniqueID(),own:!0,messages:[{content:a,time:moment().format("HH:mm")}]}],delayed:!0},!0))}$submit.on("click",function(e){e.preventDefault(),s()}),$input.on("keyup",function(e){13===(event.which||event.keyCode)&&s()})}},scutum.pages.chat.users=function(){var e=$(".sc-js-chat-users-list");e.length&&e.children("li").on("click",function(){console.log("new chat window")})},scutum.pages.chat.generateUserList=function(){scutum.require(["handlebars","chancejs"],function(){for(var e=$("#sc-user-list").html(""),s=$("#sc-user-list-offcanvas").html(""),t=scutum.helpers.mq.largeMin()?e:s,a=[],n=["online","offline","busy","away"],c=$("#userListTemplate").html(),u=Handlebars.compile(c),h=0;h<10;h++)a.push({id:scutum.helpers.uniqueID(),avatar:"0"+(Math.floor(10*Math.random())+1).toString(),username:chance.name(),sentence:chance.sentence({words:10}),status:n[Math.floor(Math.random()*n.length)]});var i=u({users:a});t.html(i),scutum.helpers.sequenceShow.init(null,!0)})},scutum.pages.chat.events=function(){scutum.$win.on("resize",scutum.helpers.debounce(scutum.pages.chat.generateUserList,500))};